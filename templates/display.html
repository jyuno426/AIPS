<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Junho Han, Seunghyun Lee, Jinwoo Shin">
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">

    <style type="text/css">
      body {
        font-family: Arial, Helvetica, Open Sans, sans-serif;
      }
      a {
        color : blue ;
        text-decoration: none;
      }
      a:hover{
        color : blue;
        text-decoration: underline;
      }
      a:visited{
        color:darkcyan;
      }
      a:active{
        color:black;
      }
      .container{
        max-width: 1050px;
        padding-top: 15px;
      }
      #footer{
        padding-top: 5px;
      }
      hr{
        border: 0;
        height: 1px;
        background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));
      }
      button.accordion{
        background-color: #e7e7e7;
        color: black;
        cursor:pointer;
        border:none;
        outline:none;
        width:100%;
        text-align:left;
        padding:8px;
        margin:4px 0;
        border-radius:4px;
        transition:0.3s;
      }
      button.accordion:hover{
        background-color:#96d2ea;
      }
      button.accordion.active{
        background-color:#96d2ea;
        color: black;
        border-radius:4px 4px 0 0;
        margin:4px 0 0;
       }
      div.panel{
        opacity:0;
        max-height:0;
        background-color:rgba(255,255,255,0.8);
        color:#000;
        border-radius:0 0 4px 4px;
        overflow: auto;
        padding:0 15px 0 15px;
        margin:0;
        transition: 0.3s ease-in;
      }
      div.panel.show{
        opacity:1;
        max-height:500px;
        padding: 8px 15px 0 15px;
        transition: 0.6s ease;
      }
      svg {
        background-color:#e7e7e7;
        width:100%;
        border-radius:4px;
      }
    </style>
    <script type="text/javascript">
      function action(accordion) {
        accordion.classList.toggle("active");
        accordion.nextElementSibling.classList.toggle("show");
      }
    </script>

    <title> Computer Science Korean Search (CSKS) </title>
  </head>

  <body>
    <br>
    <div class="container" id="header">
      <h2 style="font-family: Georgia, serif; font-weight: bold; color: #527bbd;">
        Computer Science Korean Search (CSKS)
      </h2>
    </div>
    <hr>

    <div class="container">
      <div style="width: 100%; height: 500px">
        <svg style="height: 500px;"></svg>
      </div>
      {% for name in name_list %}
        <button class="accordion" onclick="action(this)">
          <b> {{ name }} ({{ dictionary[name][1] }})</b>
        </button>
        <div class="panel">
          {{ info_dict[name] }}<br>
          <p>
            {% for title, authors, url, conf, year in dictionary[name][0] %}
              <br>
              <b>{{ conf.upper() }}</b>, {{ year }}{% for author in authors %}, {{ author }}{% endfor %}<br>
              <a href="{{ url }}" style="text-decoration:none;">
                <img alt src="../static/paper_image.png" class="icon">
              </a>
              &nbsp;<i>{{ title }}</i>
              <br>
            {% endfor %}
            <br>
          </p>
        </div>
      {% endfor %}
    </div>

    <br>
    <hr>
    <div class="container" style="text-align: center" id="footer">
      <address>CSKS was created by
        <a href="mailto:jyuno426@kaist.ac.kr"> Junho Han</a>,
        <a href="mailto:camusian@kaist.ac.kr"> Seunghyun Lee</a> and
        <a href="mailto:jinwoos@kaist.ac.kr"> Jinwoo Shin</a> at
        <a href="http://alinlab.kaist.ac.kr"> Algorithmic Intelligence Laboratory, KAIST</a>. <br> <br>
        Korean names are classified by a LSTM model, and search results for Korean authors are not perfect. <br>
        If you could notify us Korean authors that do not appear in the search results, we will incorporate them.
      </address>
    </div>



    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script>
      var name_list = {{ name_list|safe }};
      var dictionary = {{ dictionary|safe }};
      var max_papers = {{ max_papers|safe }};
      var info_dict = {{ info_dict|safe}};
      var node_colour_dict = {{ node_colour_dict|safe }};
      var edge_dict = {{ edge_dict|safe }};
      var edge_scaling_factor = {{ edge_scaling_factor|safe }};
      var nodes = [];
      for(var i=0; i<name_list.length; i++){
        nodes.push({ id: name_list[i], label: name_list[i]})
      }
      /*
      var links = [
        { target: "Sewoong Oh", source: "Honglak Lee" , strength: 1 },
        { target: "Honglak Lee", source: "Sewoong Oh" , strength: 1 },
        ]
      */
      var links = []
      for(var author in edge_dict){
        for(var coauthor in edge_dict[author]){
          links.push({ target: coauthor, source: author, strength: edge_dict[author][coauthor]/edge_scaling_factor});
        }
      }
      function getNodeSize(node){
        return Math.max(5, 20*dictionary[node.id][1]/max_papers);
      }
      function getNeighbors(node) {
        return links.reduce(function (neighbors, link) {
            if (link.target.id === node.id) {
              neighbors.push(link.source.id)
            } else if (link.source.id === node.id) {
              neighbors.push(link.target.id)
            }
            return neighbors
          },
          [node.id]
        )
      }
      function isNeighborLink(node, link) {
        return link.target.id === node.id || link.source.id === node.id
      }
      function getNodeColor(node, neighbors) {
        if (Array.isArray(neighbors) && neighbors.indexOf(node.id) > -1) {
          return 'rgba(255,255,255,0.8)'
        }

        return node_colour_dict[node.id]
      }
      function getLinkColor(node, link) {
        return isNeighborLink(node, link) ? 'black' : '#E5E5E5'
      }
      function getTextColor(node, neighbors) {
        return Array.isArray(neighbors) && neighbors.indexOf(node.id) > -1 ? 'black' : 'black'
      }
      var svg = d3.select('svg')
      var width = svg.style('width').replace("px", ""),
          height = 500,
          radius = 10;
      svg.attr('width', width).attr('height', height)
      // simulation setup with all forces
      var linkForce = d3
        .forceLink()
        .id(function (link) { return link.id })
        .strength(function (link) { return link.strength })
      var simulation = d3
        .forceSimulation()
        .force('link', linkForce)
        .force('charge', d3.forceManyBody().strength(-10))
        .force('center', d3.forceCenter(width / 2, height / 2))
      var dragDrop = d3.drag().on('start', function (node) {
        node.fx = node.x
        node.fy = node.y
      }).on('drag', function (node) {
        simulation.alphaTarget(0.7).restart()
        node.fx = d3.event.x
        node.fy = d3.event.y
      }).on('end', function (node) {
        if (!d3.event.active) {
          simulation.alphaTarget(0)
        }
        node.fx = null
        node.fy = null
      })
      function selectNode(selectedNode) {
        var neighbors = getNeighbors(selectedNode)
        // we modify the styles to highlight selected nodes
        nodeElements.attr('fill', function (node) { return getNodeColor(node, neighbors) })
        textElements.attr('fill', function (node) { return getTextColor(node, neighbors) })
        linkElements.attr('stroke', function (link) { return getLinkColor(selectedNode, link) })
      }
      var linkElements = svg.append("g")
          .attr("class", "links")
          .selectAll("line")
          .data(links)
          .enter().append("line")
          .attr("stroke-width", 1)                                // CHANGE LINK WIDTH
          .attr("stroke", "rgba(153,153,153,0.6)")
      var nodeElements = svg.append("g")
          .attr("class", "nodes")
          .attr("stroke","white")
          .selectAll("circle")
          .data(nodes)
          .enter().append("circle")
          .attr("r", getNodeSize)                                        // CHANGE NODE SIZE
          .attr("fill", getNodeColor)
          .call(dragDrop)
          .on('click', selectNode)

      var textElements = svg.append("g")
          .attr("class", "texts")
          .selectAll("text")
          .data(nodes)
          .enter().append("text")
          .text(function (node) { return  node.label })
          .attr("font-size", 10)
          .attr("dx", 5)
          .attr("dy", 3)
      simulation.nodes(nodes).on('tick', () => {
        /*
        node.attr("cx", function(d) { return d.x = Math.max(radius, Math.min(width - radius, d.x)); })
            .attr("cy", function(d) { return d.y = Math.max(radius, Math.min(height - radius, d.y)); });
        link.attr("x1", function(d) { return d.source.x; })
            .attr("y1", function(d) { return d.source.y; })
            .attr("x2", function(d) { return d.target.x; })
            .attr("y2", function(d) { return d.target.y; });
        */
        nodeElements
          .attr('cx', function (node) { return Math.max(radius, Math.min(width - radius, node.x)); })
          .attr('cy', function (node) { return Math.max(radius, Math.min(height - radius, node.y)); })
        textElements
          .attr('x', function (node) { return Math.max(radius, Math.min(width - radius, node.x)); })
          .attr('y', function (node) { return Math.max(radius, Math.min(height - radius, node.y)); })
        linkElements
          .attr('x1', function (link) { return link.source.x; })
          .attr('y1', function (link) { return link.source.y; })
          .attr('x2', function (link) { return link.target.x; })
          .attr('y2', function (link) { return link.target.y; })
      })
      simulation.force("link").links(links)
    </script>

  </body>
</html>